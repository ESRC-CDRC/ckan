String.prototype.queryStringToJSON=String.prototype.queryStringToJSON||function(){var params=String(this);if(params=params.substring(params.indexOf("?")+1),params=params.replace(/\+/g,"%20"),"{"===params.substring(0,1)&&"}"===params.substring(params.length-1))return eval(decodeURIComponent(params));params=params.split(/\&(amp\;)?/);for(var json={},i=0,n=params.length;n>i;++i){var param=params[i]||null;if(null!==param&&(param=param.split("="),null!==param)){var key=param[0]||null;if(null!==key&&"undefined"!=typeof param[1]){var value=param[1];key=decodeURIComponent(key),value=decodeURIComponent(value);var keys=key.split(".");if(1===keys.length)json[key]=value;else{var path="",cmd="";$.each(keys,function(ii,key){path+='["'+key.replace(/"/g,'\\"')+'"]',jsonCLOSUREGLOBAL=json,cmd="if ( typeof jsonCLOSUREGLOBAL"+path+' === "undefined" ) jsonCLOSUREGLOBAL'+path+" = {}",eval(cmd),json=jsonCLOSUREGLOBAL,delete jsonCLOSUREGLOBAL}),jsonCLOSUREGLOBAL=json,valueCLOSUREGLOBAL=value,cmd="jsonCLOSUREGLOBAL"+path+" = valueCLOSUREGLOBAL",eval(cmd),json=jsonCLOSUREGLOBAL,delete jsonCLOSUREGLOBAL,delete valueCLOSUREGLOBAL}}}}return json},this.ckan=this.ckan||{},this.ckan.views=this.ckan.views||{},this.ckan.views.filters=function(a){"use strict";function r(a){var r=p._searchParams.filters||{};return a?r[a]:r}function e(a,r){var e=window.location.href;n(a,r,e)}function n(a,r,e){return p._searchParams.filters=p._searchParams.filters||{},p._searchParams.filters[a]=r,s(e),p}function t(a,e){var n=r(a);if(n){var t=n.length;n===e||void 0===e?delete p._searchParams.filters[a]:$.isArray(n)&&(n=l(n,e),0===n.length?delete p._searchParams.filters[a]:p._searchParams.filters[a]=n);var i=void 0===r(a)||r(a).length!=t;i&&s(window.location.href)}return p}function s(a){var r,e=a.split("?")[0],n=a.split("?")[1]||"",t=n.queryStringToJSON(),s=i(t);r=e+"?"+s,p._setLocationHref(r)}function i(a){var r=$.extend({},a||{},p._searchParams);return r.filters&&(r.filters=$.map(r.filters,function(a,r){$.isArray(a)||(a=[a]);var e=$.map(a,function(a){return r+":"+a});return e.join("|")}).join("|")),$.param(r)}function o(a){window.location.href=a}function l(a,r){var e=a.slice(0);$.isArray(r)||(r=[r]);for(var n=0;n<r.length;n++){var t=$.inArray(r[n],e);t>-1&&e.splice(t,1)}return e}function c(a){var r=a.queryStringToJSON();if(r.filters){var e,n,t={},s=String(r.filters).split("|");for(e=0,n=s.length;n>e;e++){var i=s[e].match(/([^:]+):(.*)/),o=i[1],l=i[2];t[o]=t[o]||[],t[o].push(l)}r.filters=t}p._searchParams=r}var p={get:r,set:e,setAndRedirectTo:n,unset:t,_searchParams:{},_initialize:c,_setLocationHref:o};return c(a),p}(window.location.search);